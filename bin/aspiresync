#!/usr/bin/env php
<?php

use AspirePress\AspireSync\Commands\Download\DownloadPluginsCommand;
use AspirePress\AspireSync\Commands\Download\DownloadPluginsSingleCommand;
use AspirePress\AspireSync\Commands\Meta\MetaSyncPluginsCommand;
use AspirePress\AspireSync\Commands\Meta\MetaDumpPluginsCommand;
use AspirePress\AspireSync\Commands\SandboxCommand;
use AspirePress\AspireSync\Commands\Download\DownloadThemesCommand;
use AspirePress\AspireSync\Commands\Download\DownloadThemesSingleCommand;
use AspirePress\AspireSync\Commands\Meta\MetaSyncThemesCommand;
use AspirePress\AspireSync\Commands\Meta\MetaDumpThemesCommand;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\Console\Application;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;
use Symfony\Component\Dotenv\Dotenv;

ini_set('memory_limit', '4G');

// all-caps variable names because they're globals visible to the rest of the app

$APP_DIR = dirname(__DIR__);

require "$APP_DIR/vendor/autoload.php";

(new Dotenv())->loadEnv("$APP_DIR/.env");

$CONTAINER = new ContainerBuilder();
(new PhpFileLoader($CONTAINER, new FileLocator(__DIR__ . '/../config')))->load('services.php');
$CONTAINER->compile(resolveEnvPlaceholders: true);

$APP = new Application();

$APP->add($CONTAINER->get(DownloadPluginsCommand::class));
$APP->add($CONTAINER->get(DownloadPluginsSingleCommand::class));
$APP->add($CONTAINER->get(MetaSyncPluginsCommand::class));
$APP->add($CONTAINER->get(MetaDumpPluginsCommand::class));

$APP->add($CONTAINER->get(DownloadThemesCommand::class));
$APP->add($CONTAINER->get(DownloadThemesSingleCommand::class));
$APP->add($CONTAINER->get(MetaSyncThemesCommand::class));
$APP->add($CONTAINER->get(MetaDumpThemesCommand::class));

$APP->add($CONTAINER->get(SandboxCommand::class));

$APP->run();
