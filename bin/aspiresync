#!/usr/bin/env php
<?php

use AspirePress\AspireSync\Commands\Plugins\PluginsDownloadCommand;
use AspirePress\AspireSync\Commands\Plugins\PluginsDownloadSingleCommand;
use AspirePress\AspireSync\Commands\Plugins\PluginsMetaCommand;
use AspirePress\AspireSync\Commands\Plugins\PluginsMetaDumpCommand;
use AspirePress\AspireSync\Commands\SandboxCommand;
use AspirePress\AspireSync\Commands\Themes\ThemesDownloadCommand;
use AspirePress\AspireSync\Commands\Themes\ThemesDownloadSingleCommand;
use AspirePress\AspireSync\Commands\Themes\ThemesMetaCommand;
use AspirePress\AspireSync\Commands\Themes\ThemesMetaDumpCommand;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\Console\Application;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;
use Symfony\Component\Dotenv\Dotenv;

ini_set('memory_limit', '4G');

// all-caps variable names because they're globals visible to the rest of the app

$APP_DIR = dirname(__DIR__);

require "$APP_DIR/vendor/autoload.php";

(new Dotenv())->loadEnv("$APP_DIR/.env");

$CONTAINER = new ContainerBuilder();
(new PhpFileLoader($CONTAINER, new FileLocator(__DIR__ . '/../config')))->load('services.php');
$CONTAINER->compile(resolveEnvPlaceholders: true);

$APP = new Application();

$APP->add($CONTAINER->get(PluginsDownloadCommand::class));
$APP->add($CONTAINER->get(PluginsDownloadSingleCommand::class));
$APP->add($CONTAINER->get(PluginsMetaCommand::class));
$APP->add($CONTAINER->get(PluginsMetaDumpCommand::class));

$APP->add($CONTAINER->get(ThemesDownloadCommand::class));
$APP->add($CONTAINER->get(ThemesDownloadSingleCommand::class));
$APP->add($CONTAINER->get(ThemesMetaCommand::class));
$APP->add($CONTAINER->get(ThemesMetaDumpCommand::class));

$APP->add($CONTAINER->get(SandboxCommand::class));

$APP->run();
