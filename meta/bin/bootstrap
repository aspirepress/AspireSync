#!/bin/bash

# reinstalls aspiresync from scratch.

. $(dirname $0)/prelude.bash

function main() {
  [[ -f .env ]] || cp -v .env.dist .env

  copy_to_build

  dc down --remove-orphans --volumes --rmi local
  dc up --build --remove-orphans -d

  dcx composer install
}

function dc() {
  docker compose "$@"
}

function dcx() {
  dc exec aspiresync "$@"
}

function copy_to_build() {
  rm -rf ./build
  mkdir ./build
  cp -r ./code/config ./code/src ./code/bin ./code/composer.* ./build
}

main "$@"

